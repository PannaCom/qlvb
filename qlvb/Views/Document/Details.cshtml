@model qlvb.Models.document

@{
    ViewBag.Title = Model.name + "-" + Model.code;
    Layout = "~/Views/Shared/_Layout.cshtml";
    var lstindex = "<p style=\"background: rgb(155, 197, 229);color:#000000;height:40px;float:left;position:relative;width:100%;text-align:center;padding-top:10px;\">Danh mục <img src=\"/Images/remove.png\" onclick=\"hideindex();\" style=\"cursor:pointer;float:right;padding-right:2px;\"></p><ul style=\"float:left;\">";
    var activieTab = "in active";
    var activieCs = "class=active";
}
@*<script type="text/javascript" src="/Content/tree/simpletreemenu.js"></script>
<link rel="stylesheet" type="text/css" href="/Content/tree/simpletree.css" />*@
<style>
    table tr {
        border-bottom: 1px dotted #ccc;
        height: auto;
    }

    blockquote {
        background: #f9f9f9;
        border-left: 10px solid #ccc;
        margin: 1.5em 10px;
        padding: 0.5em 10px;
        /*quotes: "\201C""\201D""\2018""\2019";*/
        text-align: left;
    }

        blockquote:before {
            color: #ccc;
            /*content: open-quote;*/
            font-size: 4em;
            line-height: 0.1em;
            margin-right: 0.25em;
            vertical-align: -0.4em;
            text-align: left;
        }

        blockquote p {
            display: inline;
            text-align: left;
        }
</style>

    <div class="panel-body" style="position: relative; display: block; float: left;width:100%;margin-top:10px;">
        <!-- Nav tabs -->
        <ul class="nav nav-tabs">
            <li style="color:black;">
                <a href="#" data-toggle="tab" style="color:black;">Home</a>
            </li>
            <li style="color:black;">
                <a href="#tree" data-toggle="tab" style="color:black;">Hệ thống văn bản</a>
            </li>
            @if (ViewBag.chd != null && ViewBag.chd.Count > 0)
            {
                <li @activieCs>
                    <a href="#keyword" data-toggle="tab">Mục lục liên quan</a>
                </li>
                activieCs = "";
            }
            <li @activieCs>
                <a href="#full" data-toggle="tab">Toàn văn</a>
            </li>
            <li>
                <a href="#pro" data-toggle="tab">Thuộc tính</a>
            </li>
            <li>
                <a href="#rel" data-toggle="tab">Văn bản liên quan</a>
            </li>
            @*<li>
                <a href="#key" data-toggle="tab">Từ khoá liên quan</a>
            </li>*@
            <li>
                <a href="#download" data-toggle="tab">Tải về</a>
            </li>
        </ul>
        <!-- Tab panes -->
        <div class="tab-content">
            <div class="tab-pane fade" id="tree">
                @Html.Raw(@ViewBag.tree)
                @*<script type="text/javascript">
                        ddtreemenu.createTree("treemenu2", true);
                    </script>*@
            </div>
            @if (ViewBag.chd != null && ViewBag.chd.Count > 0)
            {
                <div class="tab-pane fade @activieTab" id="keyword">

                    <table style="width:100%;text-align:left;">
                        <tr>
                            <td id="lstindex" class="col-sm-3" valign="top" style="background:#ffffff;color:#000000;overflow:scroll;border-right:1px solid #ddd;" draggable="true"></td>
                            <td class="col-sm-9" style="background:#ffffff;border-right:1px solid #ddd;" onclick="hideFull();">
                                @foreach (var item in ViewBag.chd)
                                {
                                    //if (ViewBag.keyword=="")
                                    //{
                                    <text>
                                        <p style="width:100%;text-align:left;color:black;" id="@item.id"><span style="color:#000000;font-weight:bold;">@Html.Raw(@qlvb.Config.showCHD(@item.item_id))</span>: @Html.Raw(@qlvb.Config.showQuote(@item.item_content, @ViewBag.keyword))</p>
                                        @if (ViewBag.keyword != "")
                                        {
                                            <p style="width:100%;text-align:right;"><a onclick="viewchd(@item.id);" style="cursor:pointer;">Xem đầy đủ</a></p>
                                        }
                                    </text>
                                        lstindex += "<li><a href=\"#" + item.id + "\">" + qlvb.Config.showCHD(item.item_id) + "</a></li>";
                                    //}
                                }
                                <script>document.getElementById('lstindex').innerHTML = '@Html.Raw(@lstindex)' + '</ul>';</script>
                            </td>
                    </table>
                </div>
                                activieTab = "";
            }
            <div class="tab-pane fade @activieTab" id="full">
                <iframe id="namelabel" src="https://docs.google.com/viewer?url=@qlvb.Config.domain/Files/@Model.link&embedded=true" class="form-control" style="width:100%;float:left;position:relative;height:600px;"></iframe>
            </div>
            <div class="tab-pane fade" id="key">
                <table style="width:100%;text-align:left;">
                    <tr>
                        @*<td class="label">Tập từ khóa từ điều 1, điều 2... :</td>*@
                        <td colspan="2"><section class="refinements-summary">@Html.Raw(@qlvb.Config.hashtags(@Model.keyword1))</section><section class="refinements-summary">@Html.Raw(@qlvb.Config.hashtags(@Model.keyword2))</section></td>
                    </tr>
                    <tr>
                        @*<td class="label">Tập từ khóa 3(từ chương 1, chương 2...) :</td>*@
                        <td colspan="2"><section class="refinements-summary">@Html.Raw(@qlvb.Config.hashtags(@Model.keyword3))</section></td>
                    </tr>
                    <tr>
                        @*<td class="label">Tập từ khóa lặp đi lặp lại nhiều nhất trong văn bản :</td>*@
                        <td colspan="2"><section class="refinements-summary">@Html.Raw(@qlvb.Config.hashtags(@Model.keyword4))</section></td>
                    </tr>
                    
                </table>
            </div>
            <div class="tab-pane fade" id="rel">
                <table style="width:100%;text-align:left;">
                    <tr>
                        <td colspan="2">
                            <p><b>Văn bản hiện thời</b></p>
                            <section class="refinements-summary"><a href="/Document/Details?id=@Model.id">@Model.code - @Model.name</a></section>
                        </td>
                    </tr>
                    @if (Model.link_to != null && Model.link_to != "") { 
                    <tr>
                        <td colspan="2">
                            <p><b>Văn bản sửa đổi bổ sung</b></p>
                            <section class="refinements-summary">@Html.Raw(@qlvb.Config.viewhashtags(@Model.link_to))</section>
                        </td>
                    </tr>
                    }
                    @if (Model.link_to_over_date != null && Model.link_to_over_date != "")
                    {
                        <tr>
                            <td colspan="2">
                                <p><b>Văn bản hết hiệu lực</b></p>
                                <section class="refinements-summary">@Html.Raw(@qlvb.Config.viewhashtags(@Model.link_to_over_date))</section>
                            </td>
                        </tr>
                    }
                    @if (Model.be_linked != null && Model.be_linked != "")
                    {
                    <tr>
                        <td colspan="2">
                            <p><b>Văn bản căn cứ</b></p>
                            <section class="refinements-summary">@Html.Raw(@qlvb.Config.viewhashtags(@Model.be_linked))</section>
                        </td>
                    </tr>
                    }
                    <tr>
                        <td colspan="2">
                            <p><b>Văn bản liên quan</b></p>
                            <section class="refinements-summary">@Html.Raw(@qlvb.Config.viewallhashtags(@Model.keyword5, @Model.code))</section>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="tab-pane fade" id="download">
                <table style="width:100%;text-align:center;margin-top:10px;">
                    <tr>
                        <td class="label"><a href="@qlvb.Config.domain/Files/@Model.link">@Model.link</a></td>
                        <td>Lượt xem: @Model.views</td>
                    </tr>
                    
                </table>
            </div>
            <div class="tab-pane fade" id="pro">
                <h4>@Model.name</h4>
                <table style="width:100%;text-align:center;">
                    <tr>
                        <td class="label">Ký hiệu :</td>
                        <td>@Model.code</td>
                        <td class="label">Lĩnh vực :</td>
                        <td>@qlvb.Config.getCatNameById(1, @Model.cat1_id)</td>
                    </tr>
                    <tr>
                        <td class="label">Loại văn bản :</td>
                        <td>@qlvb.Config.getCatNameById(2, @Model.cat2_id)</td>
                        <td class="label">Người ký :</td>
                        <td>@qlvb.Config.getCatNameById(3, @Model.cat3_id)</td>
                    </tr>
                    <tr>
                        <td class="label">Cơ quan ban hành :</td>
                        <td>@qlvb.Config.getCatNameById(4, @Model.cat4_id)</td>
                        <td class="label">Ngày ban hành :</td>
                        <td>@qlvb.Config.formatDDMMYYYY(@Model.date_publish)</td>
                    </tr>
                    <tr>
                        <td class="label">Ngày có hiệu lực :</td>
                        <td>@qlvb.Config.formatDDMMYYYY(@Model.date_start)</td>
                        <td class="label">Còn hiệu lực? :</td>
                        <td>@qlvb.Config.statusStr(@Model.status)</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    <div id=dvchditems style="width:50%;float:left;position:fixed;top:0px;left:10px;background-color:#f9f9f9;color:#000000;z-index:2001;text-align:center;display:none;">
        <div id=chditems class="col-lg-3" valign="top" style="width:100%;height:300px;background:#ffffff;color:#000000;text-align:left;overflow:scroll;border:2px solid #0094ff;"></div>
        @*<iframe id=chditems style="width:100%;display:block;float:left;position:relative;text-align:left;overflow:scroll;"></iframe>*@
        <input type="button" value="Đóng lại" onclick="$('#dvchditems').hide();" class="btn btn-primary tf-btn color" style="position:relative; width:100px;" />
    </div>
    <script>
        function hideindex() {
            $('#lstindex').hide();
        }
        function show(id) {
            $("#" + id).show();
        }
        function searchkw(keyword) {
            var url = "/Home/Index?";
            var k = keyword;
            //if (k == "") {
            //    return;
            //}
            var f1 = "";
            var f2 = "";
            var f3 = "";
            var f4 = "";
            var st = 0;
            var status = 2;
            var tps = 1;
            var ft = 1;
            url += "k=" + k + "&f1=" + f1 + "&f2=" + f2 + "&f3=" + f3 + "&f4=" + f4 + "&st=" + st + "&status=" + status + "&tps=" + tps + "&ft=" + ft;// + "&order=" + order + "&to=" + to + "&pg=" + pg
            window.location.href = url;
        }

        $(document).ready(function () {

            $(window).scroll(function () {
                if ($(this).scrollTop() > 100) {
                    $('.scrollup').fadeIn();
                    //$('#lstindex').css("position", "fixed");
                    //$('#lstindex').css("top", "0px");
                    //$('#lstindex').css("left", "50px");
                    //$('#lstindex').css("height", "400px");
                    //$('#lstindex').css("z-index", "1001");
                } else {
                    $('.scrollup').fadeOut();
                    //$('#lstindex').show();
                    //$('#lstindex').css("position", "relative");
                    //$('#lstindex').css("top", "auto");
                    //$('#lstindex').css("left", "auto");
                    //$('#lstindex').css("z-index", "0");
                    //$('#lstindex').css("height", "auto");
                    
                }
            });

            $('.scrollup').click(function () {
                $("html, body").animate({
                    scrollTop: 0
                }, 600);
                return false;
            });

        });
        var isloadedchd = false;
        function viewchd(id) {
            $('#dvchditems').show();
            isloadedchd = false;
            //$("#chditems").attr("src","/Document/Items/"+id);
            $("#chditems").html("<img src='/images/loading.gif'>");
            $.ajax({
                url: "/Document/getCHD?id=" + id,
                cache: false
            }).done(function (html) {
                //html = html.replace(/\s\s/g, " ");
                //html = html.replace(/	/g, "");
                //html = html.replace('\r\n', "<br>");
                //$('#dvchditems').hide();
                //alert(html);
                $("#chditems").html(html);
                isloadedchd = true;

            });
        }
        function hideFull() {
            if (isloadedchd) {
                $('#dvchditems').hide();
            }
        }
    </script>
