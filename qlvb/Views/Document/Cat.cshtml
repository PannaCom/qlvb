
@model PagedList.IPagedList<qlvb.Controllers.DocumentController.catlist>
@using PagedList.Mvc; 
@{
    ViewBag.Title = "Văn Bản Quy Phạm";
    Layout = "~/Views/Shared/_Layout.cshtml";
    
    int count = 0;
}
<div class="col-sm-3" id="mnleft">
    <div style="margin-top:10px;float:left;position:relative;border:1px solid #ff6a00;border-radius:5px;">
        <div style="background:rgb(155, 197, 229);color:#000000;height:40px;float:left;position:relative;width:100%;text-align:left;padding-top:10px;padding-left:15px;">
            Lĩnh vực
        </div>
        <ul id="allcat1" style="text-align:left;float:left;position:relative;padding-left: 16px"></ul>
        <div style="background:rgb(155, 197, 229);color:#000000;height:40px;float:left;position:relative;width:100%;text-align:left;padding-top:10px;padding-left:15px;">
            Loại văn bản
        </div>
        <ul id="allcat2" style="text-align:left;float:left;position:relative;padding-left: 16px"></ul>
        @*<div style="background:#74b709;color:#ffffff;height:40px;float:left;position:relative;width:100%;text-align:center;padding-top:10px;">
            Từ khóa gợi ý
        </div>
        <section class="refinements-summary" style="text-align:left;">
            <ul id="allhotkeyword" style="text-align:left;float:left;position:relative;">
                Đang tải...
            </ul>
        </section>*@
    </div>
</div>
<div class="col-sm-9">
        <div style="background-color:#ffffee;margin-top:10px;border:1px solid #ff6a00;border-radius:5px;float:left;position:relative;padding-left:5px;" id="filterdiv">
            <h4>Bộ lọc tìm kiếm</h4>
            <div style="width:100%;float:left;display:block;text-align: left;margin-top:2px;">
                <section class="refinements-summary">
                    @if (ViewBag.f1 != null || ViewBag.f2 != null || ViewBag.f4 != null)
                    {
                        <b>Đang lọc theo: </b>@Html.Raw(qlvb.Config.tagscat(@ViewBag.f1, @ViewBag.f2, @ViewBag.f4))

                        <a style="cursor:pointer;" onclick="resetCat();">xóa bộ lọc</a>
                    }
                </section>
            </div>

            @*<div style="width:100%;">
                    <input type="text" class="form-control" placeholder="Từ khóa" id="word" name="word" value="@ViewBag.keyword" style="width:60%;display:block;float:left;position:relative;" onkeyup="autosearch(event);">
                    <input type="button" value="tìm kiếm" onclick="search();" class="btn btn-primary tf-btn color" style="display:block;float:left;position:relative;"/>
                </div>*@
            <div style="width:100%;float:left;display:block;text-align: left;margin-top:2px;">
                @Html.Raw(@ViewBag.cat1)
            </div>
            <div style="width:100%;float:left;display:block;text-align: left;margin-top:2px;">
                @Html.Raw(@ViewBag.cat2)
            </div>
            <div style="width:100%;float:left;display:block;text-align: left;margin-top:2px;">
                @Html.Raw(@ViewBag.cat4)
            </div>

        </div>
        <div style="width:100%;padding-top:30px;">
            <div style="width:100%;padding-top:30px;">
                <div class="span9">
                    @if (ViewBag.keyword != "")
                    {
                        <text> <h5>Tìm thấy (@Model.TotalItemCount) - <span>văn bản</span></h5></text>
                    }
                    else
                    {
                        <text> <h5>Xem nhiều nhất</h5></text>
                    }

                </div><div class="span4">
                    @if (ViewBag.keyword != "")
                    {
                        <text>Sắp xếp theo:
                            <select id="order" onchange="chooseOder();">
                                <option value="-1">Chọn</option>
                                <option value="1">Lĩnh vực văn bản(Luật,Nghị định...)</option>
                                @* <option value="2">Mới nhất</option>
                                    <option value="3">Cũ nhất</option>*@
                                <option value="2">Xem nhiều nhất</option>
                            </select>
                        </text>
                    }
                </div>
            </div>
            <table class="table" style="border-collapse: collapse;border-spacing: 0;border-spacing: 2px;border-color: grey;border:1px solid #808080;">
               
                @foreach (var item in Model)
                {
                    <tr>
                        <td valign="top">
                            <div class="col-sm-12" style="background:#f1f1f1;width:100%;"><b style="float:left;">@qlvb.Config.getCatNameById(2, @item.cat2_id) @item.code</b></div>
                            <div class="row">
                                <div class="col-sm-8" style="height:80px;float: left;border-right: 1px dotted #ccc;padding-right:1%;text-align:left;padding-top:2px;">
                                   
                                    <a href="/Document/Details?id=@item.id" target="_blank">@item.name </a>
                                   
                                </div>
                                <div class="col-sm-4" style="float:right;height:80px;">
                                    <table>
                                        <tr><td style="text-align:left;width:50px;"><p style="font-size:12px;">Lĩnh vực: </p></td><td style="text-align:left;"><p style="font-size:12px;">@qlvb.Config.getCatNameById(1, @item.cat1_id)</p></td></tr>
                                        @if (item.date_publish != null)
                                        {
                                            <tr><td style="text-align:left;width:100px;"><p style="font-size:12px;">Ban hành: </p></td><td style="text-align:left;"><p style="font-size:12px;">@qlvb.Config.formatDDMMYYYY(@item.date_publish)</p></td></tr>
                                        }
                                        @if (item.date_start != null)
                                        {
                                            <tr><td style="text-align:left;width:100px;"><p style="font-size:12px;">Hiệu lực: </p></td><td style="text-align:left;"><p style="font-size:12px;">@qlvb.Config.formatDDMMYYYY(@item.date_start)</p></td></tr>
                                        }
                                    </table>
                                </div>
                            </div>
                        </td>
                    </tr>
                                        count++;
                    //allHotKeyword+=@item.ke
                }
            </table>

            <div>
                Trang:
                @for (int i = 1; i <= Model.PageCount; i++)
                {
                    <a onclick="setpage(@i);" style="cursor:pointer;">@i,</a>
                }
            </div>
        </div>
    
</div>
<script>
    var pg=@ViewBag.page;
    var order="@ViewBag.order";
    var to="@ViewBag.to";
    var currentCat1="@ViewBag.f1";
    var currentCat2="@ViewBag.f2";
    @*var currentCat3="@ViewBag.f3";*@
    var currentCat4="@ViewBag.f4";
    if (order.toString().indexOf("No")>=0){
        $("#order").val(1);
    }
    //if (order.toString().indexOf("code")>=0 && to.toString().indexOf("Desc")>=0){
    //    $("#order").val(2);
    //}
    //if (order.toString().indexOf("code")>=0 && to.toString().indexOf("Asc")>=0){
    //    $("#order").val(3);
    //}
    if (order.toString().indexOf("views")>=0){
        $("#order").val(2);
    }
    function resetCat(){
        currentCat1="";
        currentCat2="";
        //currentCat3="";
        currentCat4="";
        search();
    }
    function setCat(type,val){
        switch(type){
            case 1:
                currentCat1=val;
                break;
            case 2:
                currentCat2=val;
                break;
            case 3:
                currentCat3=val;
                break;
            case 4:
                currentCat4=val;
                break;
        }
        search();
    }
    function chooseOder(){
        if ($("#order").val()=="1"){
            setorder('No','Desc');
        }
            //else
            //    if ($("#order").val()=="2"){
            //        setorder('code','Desc');
            //    }
            //    else
            //        if ($("#order").val()=="3"){
            //            setorder('code','Asc');
            //        }
        else
            if ($("#order").val()=="2"){
                setorder('views','Desc');
            }
    }
    function setorder(field,t) {
        order=field;
        to=t;
        pg=1;
        search();
    }
    function setpage(page) {
        pg=page;
        search();
    }
    function search() {
        var url = "/Document/index?";
        var k = $("#word").val();
        //if (k == "") {
        //    return;
        //}
        var f1="";
        var f2="";
        var f3="";
        var f4="";
        f1=currentCat1;
        f2=currentCat2;
        //f3=currentCat3;
        f4=currentCat4;
        url = "/Document/Cat?cat11=" + f1 + "&cat22=" + f2 + "&cat44=" + f4+"&order="+order+"&to="+to+"&pg="+pg;
        window.location.href = url;
    }
    //function search() {
    //    var word = document.getElementById("word").value;
    //    window.location.href = "/Document/Index?page=1&word=" + word;
    //}
    function autosearch(e) {
        var keyword = document.getElementById("word").value;
        urlSearch = '/Document/getDoc?keyword=';
        $('#word').autocomplete({
            source: urlSearch + keyword,
            select: function (event, ui) {
                //$(event.target).val(ui.item.value);
                //search();
                //alert(ui.item.id);
                window.open("/Document/Details/"+ui.item.id,"_blank");
                return false;
            },
            minLength: 1
        });
        var keyCode = e.keyCode || e.which;//('which' in event) ? event.which : event.keyCode;
        
        //alert(keyCode);
        if (keyCode == 13) {
            if (keyword == "") {
                alert("Bạn phải nhập từ khóa");
                return;
            }else{
                search();
            }
        }
    }
    if ("@ViewBag.user"!=""){
        $("#loginli").hide();
        $("#logoutli").show();
    }
    $.ajax({
        url: "/Home/getAllCat?id=1",
        cache: false
    }).done(function( html ) {
        $( "#allcat1").html(""+html);
    });
    $.ajax({
        url: "/Home/getAllCat?id=2",
        cache: false
    }).done(function( html ) {
        $( "#allcat2").html(""+html);
    });
    function gotoCat(type,id){
        if (type==1){
            window.location.href ="/Document/Cat?cat11="+id;
        }
        if (type==2){
            window.location.href ="/Document/Cat?cat22="+id;
        }
    }
</script>
